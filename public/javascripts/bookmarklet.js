var getRand=function(b,a){return(Math.random()*(a-b))+b};var captchafy=function(a){this.canvas=a;this._text="";this.fontSize=64;this.fontFace="Times";this.padding=0;this.textWidth=0;var b=[];this.init=function(e,c,f,d){this._text=e;this.fontSize=c;if(f){this.fontFace=f}this.padding=d;this.adjustSize();return this};this.saveContext=function(){};this.restoreContext=function(){};this.add=function(e,d){var c=this.canvas;b.push(function(){e(c,d)});return this};this.adjustSize=function(){var c=this.canvas.getContext("2d");c.font=this.fontSize+"px "+this.fontFace;var d=c.measureText(this._text).width;this.textWidth=d;this.canvas.width=(d+(this.padding?this.padding:0))*2;this.canvas.height=(this.fontSize+(this.padding?this.padding:0))*4};this.render=function(){b.forEach(function(e,d,c){e.call(e)})};this.toDataURL=function(){return this.canvas.toDataURL()};this.crop=function(){var f=this.canvas.getContext("2d");var c=f.getImageData(0,0,this.canvas.width,this.canvas.height);var m=c.data;var e=0,d=0,j=this.canvas.width,g=this.canvas.height;var h=false;for(var l=0;l<m.length;l+=4){var k=m[l+3];if(k!=0){h=true;var p=Math.floor((l/4)%c.width)+1;var o=Math.floor((l/4)/c.width)+1;if(p<j){j=p}if(p>e){e=p}if(o<g){g=o}if(o>d){d=o}}}if(!h){}var n=f.getImageData(j,g,(e-j),(d-g));this.canvas.width=e-j;this.canvas.height=d-g;f.putImageData(n,0,0)}};var ex={create:function(a){return new captchafy(a)},captchafyText:function(b,h,g){var f=function(j){var e=/^\s*$/;return b(j).find("*").andSelf().contents().filter(function(){return(this.nodeType==3)&&!e.test(this.nodeValue)})};var a=function(k){var j=k.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete (j[0]);for(var e=1;e<=3;++e){j[e]=parseInt(j[e]).toString(16);if(j[e].length==1){j[e]="0"+j[e]}}return"#"+j.join("").toUpperCase()};var d=true;try{f(h).each(function(){var t=parseInt(b(this.parentNode).css("font-size"));var s=this.nodeValue;if(!!s&&!!t&&(b(this.parentNode).is(":visible"))){var n=a(b(this.parentNode).css("color"));var l="Times";try{l=b(this.parentNode).css("font-family").split(",")[0]}catch(p){}var r=s.split(" ");var k=[];var e=document.createElement("canvas");document.body.appendChild(e);for(var o=0;o<r.length;o++){var j=r[o];if(!j){continue}if(j.length<3){k.push("<span>"+j+"</span>");continue}d=!d;if(d){k.push("<span>"+j+"</span>");continue}try{var q=ex.create(e);q.init(j,t,l,t/5);q.add(ex.text.wavy,{text:j,size:t,fillStyle:n,font:l});if(j.length>2){q.add(ex.noise.blob,{fillStyle:n,size:t,h:t*0.75,w:(q.textWidth/1.5)})}q.render();q.crop();k.push('<span style="display:inline-block;width:'+q.canvas.width+"px;height:"+q.canvas.height+"px;background-image:url('"+q.toDataURL()+"')\"></span>")}catch(m){console.log(m.message);console.log(m)}}b(this).replaceWith(k.join(" ")+" ");document.body.removeChild(e)}});g()}catch(c){console.log(c)}},noise:{straightLines:function(e,n){var a=e.height;var c=e.width;n=n?n:{};var j=n.width?n.width:Math.ceil(a*0.025);var m=n.color?n.color:"#000000";var b=n.count?n.count:3;var d=e.getContext("2d");d.strokeStyle=m;d.lineWidth=j;for(var f=0;f<b;f++){var g=(a/4)+Math.floor(Math.random()*(a/2));var k=(a/4)+Math.floor(Math.random()*(a/2));var h=Math.floor(Math.random()*(c/10));var l=c-h;d.beginPath();d.moveTo(h,g);d.lineTo(l,k);d.closePath();d.stroke()}},blob:function(c,p){var j=function(r,q){if(!q){q=0.2}var h=(-1)*q;return r+(getRand(r*q,r*h))};context=c.getContext("2d");var m=p.fillStyle?p.fillStyle:"black";var o=p.size?p.size:64;var k=(p.w?p.w:c.width/5)/2,d=p.h?p.h:c.height/4,g=p.x?p.x:(c.width/2)-k,f=p.y?p.y:(c.height/2)+(d/2);context.save();context.fillStyle=m;context.setTransform(1,0,0,1,0,0);context.globalCompositeOperation="xor";context.beginPath();var b=startX=j(g),a=startY=j(f);var l=[{x:j(g),y:j(f)},{x:j(g-k),y:j(f)},{x:j(g-k),y:j(f-d)},{x:j(g),y:j(f-d)},{x:j(g+k),y:j(f-d)},{x:j(g+k),y:j(f)}];context.moveTo((l[0].x+l[l.length-1].x)/2,(l[0].y+l[l.length-1].y)/2);for(i=1;i<l.length-1;i++){var n=(l[i].x+l[i+1].x)/2;var e=(l[i].y+l[i+1].y)/2;context.quadraticCurveTo(l[i].x,l[i].y,n,e)}var n=(l[i].x+l[0].x)/2;var e=(l[i].y+l[0].y)/2;context.quadraticCurveTo(l[i].x,l[i].y,n,e);context.fill();context.restore()},snow:function(c,b){b=b?b:{};var a=b.opacity?b.opacity:0.2;var d=c.getContext("2d");for(x=0;x<c.width;x+=10){for(y=0;y<c.height;y+=10){var e=Math.floor(Math.random()*60);d.fillStyle="rgba("+e+","+e+","+e+","+a+")";d.fillRect(x,y,5,5)}}}},gimp:{shadow:function(d,c,f){c=c?c:{};var a=c.x?c.x:5;var g=c.x?c.y:5;var b=c.color?c.color:"rgba(0,0,0,.25)";var e=d.getContext("2d");e.shadowOffsetX=a;e.shadowOffsetY=g;e.shadowColor=b;if(f){f.call(e)}}},text:{basic:function(d,c,a){var e=d.getContext("2d");c=c?c:{};var g=c.text?c.text:"";var f=c.size?c.size:64;var h=c.font?c.font:"Times";var b=c.fillStyle?c.fillStyle:"black";e.save();e.font=f+"px "+h;e.fillStyle=b;e.textAlign="left";e.textBaseline="middle";e.translate(d.width/2,d.height/2);e.fillText(g,0,0);if(a){a(e)}e.restore()},wavy:function(b,o,d){var a=b.getContext("2d");o=o?o:{};var m=o.text?o.text:"";var n=o.size?o.size:64;var f=o.font?o.font:"Times";var l=o.fillStyle?o.fillStyle:"black";a.save();a.font=n+"px "+f;a.fillStyle=l;a.textAlign="left";a.textBaseline="middle";a.translate(10,b.height/2);var e=Math.min(0.5,(n/64));for(var j=0;j<m.length;j++){a.save();var h=m.charAt(j);var g=a.measureText(h);var k=g.width;a.transform(1,getRand(-1*e,e),getRand(-1*e,e),1,0,0);a.fillText(h,0,0);a.restore();a.translate(k,0)}if(d){d(a)}a.restore()}}};ex.captchafyText(jQuery,jQuery(document.body),function(){jQuery(document.body).addClass("captchafied")});